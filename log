(lua:17774): GLib-GIO-ERROR **: 14:31:45.917: No GSettings schemas are installed on the system
Trace/breakpoint trap      (core dumped) lua main.lua#!/usr/bin/env lua
local lgi = require 'lgi'
local Gtk = lgi.require('Gtk', '3.0')

local window = Gtk.Window {
  title = 'window',
  default_width = 400,
  default_height = 300,
  on_destroy = Gtk.main_quit,
  Gtk.Box {
    orientation = 'VERTICAL',
    id = 'box',
    Gtk.Entry {
      id = 'entry',
      text = "Hello, World!"
    },
    Gtk.Button {
      id = 'button',
      label = "default text"
    }
  }
}

function saveToFile(filename, data)
  local file = io.open(filename, "w")

  if file then
    file:write(data)
    file:close()
    print("save success")
  else
    print("save failed")
  end
end

function show_save_dialog(data)
  local native = Gtk.FileChooserNative {
    title = "Select a file",
    action = Gtk.FileChooserAction.SAVE,
    accept_label = "_Save",
    cancel_label = "_Cancel",
    modal = true
  }
  local response = native:run()
  if response == Gtk.ResponseType.ACCEPT then
    local file = native:get_file()
    print("Saving to: " .. file:get_path())
    saveToFile(file:get_path(), data)
  elseif response == Gtk.ResponseType.CANCEL then
    print("Save cancelled")
  end
  native:destroy()
end

function window.child.button:on_clicked()
  window.child.button:set_label(window.child.entry.text)
  show_save_dialog(window.child.entry.text)
end
if tonumber(Gtk._version) >= 3 then
  window.has_resize_grip = true
end
window:show_all()
Gtk.main()
